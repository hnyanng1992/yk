<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡ ä½•æ•°æ®å±•ç¤ºå·¥å…·</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body, #container {
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        
        .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 420px;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            z-index: 10;
            max-height: 95vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #3388FF, #4A90E2);
            color: white;
            padding: 18px 20px;
            border-radius: 12px 12px 0 0;
            margin: 0;
            position: sticky;
            top: 0;
            z-index: 11;
            flex-shrink: 0;
        }
        
        .panel-header h3 {
            margin: 0;
            font-size: 20px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .panel-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 0;
            background: white;
            z-index: 10;
            flex-shrink: 0;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 14px 8px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 15px;
            font-weight: 500;
            color: #666;
        }
        
        .tab.active {
            border-bottom: 3px solid #3388FF;
            color: #3388FF;
            background-color: #f8fbff;
        }
        
        .current-tab-indicator {
            background: #e7f3ff;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 0;
            font-size: 14px;
            border-left: 4px solid #3388FF;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-tab-indicator::before {
            content: "ğŸ“";
            font-size: 16px;
        }
        
        .action-buttons {
            background: white;
            padding: 0 0 12px 0;
            margin: 0;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .main-button-group {
            display: flex;
            gap: 10px;
            margin: 0;
        }
        
        .main-button-group button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: #3388FF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #297acc;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(51, 136, 255, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }
        
        .tab-content {
            display: none;
            flex: 1;
            flex-direction: column;
            gap: 12px;
        }
        
        .tab-content.active {
            display: flex;
        }
        
        .format-indicator {
            padding: 10px 14px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
            border-left: 4px solid #28a745;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .format-indicator::before {
            content: "ğŸ“‹";
        }
        
        .format-indicator.wkt {
            border-left-color: #3388FF;
        }
        
        .format-indicator.coords {
            border-left-color: #28a745;
        }
        
        .input-item {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        
        .input-item textarea {
            width: 100%;
            flex: 1;
            min-height: 320px;
            margin: 0;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            box-sizing: border-box;
            line-height: 1.6;
            transition: border 0.3s;
        }
        
        .input-item textarea:focus {
            border-color: #3388FF;
            outline: none;
            box-shadow: 0 0 0 2px rgba(51, 136, 255, 0.2);
        }
        
        .format-example {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
            flex-shrink: 0;
            padding: 0 4px;
        }
        
        .legend {
            padding: 14px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 10px;
        }
        
        .legend-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-title::before {
            content: "ğŸ¨";
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 4px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .legend-point {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            background-color: #3388FF;
        }
        
        .legend-polygon {
            background-color: #FF6B6B;
        }
        
        .legend-point-color {
            background-color: #28a745;
        }
        
        .status-message {
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 8px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        @media (max-width: 768px) {
            .control-panel {
                width: calc(100% - 40px);
                max-height: 85vh;
            }
            
            .input-item textarea {
                min-height: 250px;
            }
            
            .panel-content {
                gap: 12px;
            }
            
            .main-button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div class="control-panel">
        <div class="panel-header">
            <h3>å‡ ä½•æ•°æ®å±•ç¤ºå·¥å…·</h3>
        </div>
        
        <div class="panel-content">
            <!-- æ ‡ç­¾å¯¼èˆª - å¤šè¾¹å½¢æ•°æ®é»˜è®¤æ¿€æ´» -->
            <div class="tabs">
                <div class="tab" data-tab="points">ç‚¹æ•°æ®</div>
                <div class="tab" data-tab="lines">çº¿æ•°æ®</div>
                <div class="tab active" data-tab="polygons">å¤šè¾¹å½¢æ•°æ®</div>
            </div>
            
            <!-- å½“å‰é€‰ä¸­æŒ‡ç¤ºå™¨ -->
            <div class="current-tab-indicator" id="current-tab-indicator">
                å½“å‰é€‰ä¸­: <strong>å¤šè¾¹å½¢æ•°æ®</strong>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <div class="main-button-group">
                    <button class="btn-success" id="show-current-btn">
                        <span>ğŸ”</span> æ˜¾ç¤ºå½“å‰å›¾å½¢
                    </button>
                    <button class="btn-primary" id="show-all-btn">
                        <span>ğŸ—ºï¸</span> æ˜¾ç¤ºæ‰€æœ‰å›¾å½¢
                    </button>
                    <button class="btn-secondary" id="clear-all-btn">
                        <span>ğŸ—‘ï¸</span> æ¸…é™¤æ‰€æœ‰
                    </button>
                </div>
            </div>
            
            <!-- ç‚¹æ•°æ®æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="points-tab">
                <div class="format-indicator" id="points-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="points-input" placeholder="è¯·è¾“å…¥ç‚¹æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457

WKTæ ¼å¼ç¤ºä¾‹:
POINT(116.123 39.456)
MULTIPOINT((116.123 39.456),(116.124 39.457))">POINT (104.065603 30.641998)</textarea>
                </div>
                <div class="format-example">
                    æç¤º: ç‚¹æ•°æ®æ”¯æŒåæ ‡ä¸²(ç»åº¦,çº¬åº¦;ç»åº¦,çº¬åº¦)å’ŒWKT(POINT/MULTIPOINT)æ ¼å¼
                </div>
            </div>
            
            <!-- çº¿æ•°æ®æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="lines-tab">
                <div class="format-indicator" id="lines-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="lines-input" placeholder="è¯·è¾“å…¥çº¿æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457|116.125,39.458;116.126,39.459

WKTæ ¼å¼ç¤ºä¾‹:
LINESTRING(116.123 39.456,116.124 39.457)
MULTILINESTRING((116.123 39.456,116.124 39.457),(116.125 39.458,116.126 39.459))">MULTILINESTRING ((116.4279376 39.8443999,116.4278987 39.8444812,116.4278609 39.8445569,116.4277498 39.8447601,116.4276442 39.8450061,116.4275502 39.8452521,116.427444 39.8456184,116.4273939 39.8458195,116.4273544 39.8460234,116.4273322 39.8462702,116.4273638 39.8475818,116.4273641 39.8477638,116.4273658 39.8481813,116.4274092 39.8492723,116.4274145 39.850016,116.4274133 39.8505162,116.4272741 39.8511361,116.4272158 39.8513956,116.4269254 39.8527613,116.4265736 39.8540205,116.4265071 39.8542773,116.4263762 39.8548852,116.4262754 39.8553714,116.4261895 39.8557862,116.4259371 39.8570047))</textarea>
                </div>
                <div class="format-example">
                    æç¤º: çº¿æ•°æ®æ”¯æŒåæ ‡ä¸²(ä½¿ç”¨|åˆ†éš”ä¸åŒçº¿æ®µ)å’ŒWKT(LINESTRING/MULTILINESTRING)æ ¼å¼
                </div>
            </div>
            
            <!-- å¤šè¾¹å½¢æ•°æ®æ ‡ç­¾é¡µ - é»˜è®¤æ¿€æ´» -->
            <div class="tab-content active" id="polygons-tab">
                <div class="format-indicator" id="polygon-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="polygon-input" placeholder="è¯·è¾“å…¥å¤šè¾¹å½¢æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457;116.125,39.458;116.123,39.456

WKTæ ¼å¼ç¤ºä¾‹:
POLYGON((116.123 39.456,116.124 39.457,116.125 39.458,116.123 39.456))
MULTIPOLYGON(((116.123 39.456,116.124 39.457,116.125 39.458,116.123 39.456)))">POLYGON((116.417694 39.915705, 116.426632 39.915584, 116.426236 39.924278, 116.417476 39.924379, 116.417694 39.915705))

POLYGON((116.397694 39.935705, 116.406632 39.935584, 116.406236 39.944278, 116.397476 39.944379, 116.397694 39.935705))

POLYGON((116.437694 39.895705, 116.446632 39.895584, 116.446236 39.904278, 116.437476 39.904379, 116.437694 39.895705))</textarea>
                </div>
                <div class="format-example">
                    æç¤º: å¤šè¾¹å½¢æ•°æ®æ”¯æŒåæ ‡ä¸²(é¦–å°¾åæ ‡éœ€ç›¸åŒä»¥é—­åˆ)å’ŒWKT(POLYGON/MULTIPOLYGON)æ ¼å¼
                </div>
            </div>
            
            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div class="status-message" id="status-message"></div>
            
            <!-- å›¾ä¾‹ -->
            <div class="legend">
                <div class="legend-title">å›¾ä¾‹è¯´æ˜</div>
                <div class="legend-item">
                    <div class="legend-point legend-point-color"></div>
                    <span>ç‚¹æ•°æ®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-line"></div>
                    <span>çº¿æ•°æ®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-polygon"></div>
                    <span>å¤šè¾¹å½¢æ•°æ®</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=1cf9fc45df860df45e87af1230f5da74"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åœ°å›¾
            var map = new AMap.Map('container', {
                zoom: 14,
                center: [116.422, 39.920],
                viewMode: '3D'
            });
            
            var points = [], lines = [], polygons = [], currentTab = 'polygons'; // é»˜è®¤å½“å‰æ ‡ç­¾ä¸ºå¤šè¾¹å½¢
            
            // è‡ªåŠ¨æ£€æµ‹æ ¼å¼çš„å‡½æ•°
            function detectFormat(input, type) {
                if (!input || input.trim() === '') return 'unknown';
                
                var text = input.trim().toUpperCase();
                
                // WKTæ ¼å¼æ£€æµ‹
                if (type === 'points') {
                    if (text.startsWith('MULTIPOINT') || text.startsWith('POINT')) return 'wkt';
                } else if (type === 'lines') {
                    if (text.startsWith('MULTILINESTRING') || text.startsWith('LINESTRING')) return 'wkt';
                } else if (type === 'polygons') {
                    if (text.startsWith('MULTIPOLYGON') || text.startsWith('POLYGON')) return 'wkt';
                }
                
                // åæ ‡ä¸²æ ¼å¼æ£€æµ‹
                // æ£€æŸ¥æ˜¯å¦åŒ…å«åˆ†å·åˆ†éš”ç¬¦ï¼ˆåæ ‡ä¸²æ ¼å¼çš„ç‰¹å¾ï¼‰
                if (input.includes(';')) {
                    // è¿›ä¸€æ­¥éªŒè¯åæ ‡æ ¼å¼
                    var parts = input.split(';');
                    var validCoords = parts.some(part => {
                        var coords = part.split(',');
                        if (coords.length === 2) {
                            var lng = parseFloat(coords[0]), lat = parseFloat(coords[1]);
                            return !isNaN(lng) && !isNaN(lat);
                        }
                        return false;
                    });
                    if (validCoords) return 'coords';
                }
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«ç©ºæ ¼åˆ†éš”ç¬¦ï¼ˆåæ ‡ä¸²æ ¼å¼çš„å¦ä¸€ç§å½¢å¼ï¼‰
                if (input.includes(' ') && input.includes(',')) {
                    var parts = input.split(' ');
                    var validCoords = parts.some(part => {
                        if (part.includes(',')) {
                            var coords = part.split(',');
                            if (coords.length === 2) {
                                var lng = parseFloat(coords[0]), lat = parseFloat(coords[1]);
                                return !isNaN(lng) && !isNaN(lat);
                            }
                        }
                        return false;
                    });
                    if (validCoords) return 'coords';
                }
                
                return 'unknown';
            }
            
            // æ›´æ–°æ ¼å¼æŒ‡ç¤ºå™¨
            function updateFormatIndicator(type) {
                var inputElement, indicatorElement;
                
                if (type === 'points') {
                    inputElement = document.getElementById('points-input');
                    indicatorElement = document.getElementById('points-format-indicator');
                } else if (type === 'lines') {
                    inputElement = document.getElementById('lines-input');
                    indicatorElement = document.getElementById('lines-format-indicator');
                } else if (type === 'polygons') {
                    inputElement = document.getElementById('polygon-input');
                    indicatorElement = document.getElementById('polygon-format-indicator');
                }
                
                if (inputElement && indicatorElement) {
                    var format = detectFormat(inputElement.value, type);
                    if (format === 'wkt') {
                        indicatorElement.innerHTML = 'æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>';
                        indicatorElement.className = 'format-indicator wkt';
                    } else if (format === 'coords') {
                        indicatorElement.innerHTML = 'æ£€æµ‹åˆ°æ ¼å¼: <strong>åæ ‡ä¸²</strong>';
                        indicatorElement.className = 'format-indicator coords';
                    } else {
                        indicatorElement.innerHTML = 'æ ¼å¼: <strong>æœªçŸ¥</strong>';
                        indicatorElement.className = 'format-indicator';
                    }
                }
            }
            
            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            function showStatus(message, isSuccess) {
                var statusElement = document.getElementById('status-message');
                statusElement.textContent = message;
                statusElement.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
                statusElement.style.display = 'block';
                
                // 5ç§’åè‡ªåŠ¨éšè—
                setTimeout(function() {
                    statusElement.style.display = 'none';
                }, 5000);
            }
            
            // æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-tab').classList.add('active');
                    currentTab = tabId;
                    updateCurrentTabIndicator();
                });
            });

            // è¾“å…¥æ¡†å†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨æ£€æµ‹æ ¼å¼
            document.getElementById('points-input').addEventListener('input', function() {
                updateFormatIndicator('points');
            });
            
            document.getElementById('lines-input').addEventListener('input', function() {
                updateFormatIndicator('lines');
            });
            
            document.getElementById('polygon-input').addEventListener('input', function() {
                updateFormatIndicator('polygons');
            });

            function updateCurrentTabIndicator() {
                const tabNames = { 
                    'points': 'ç‚¹æ•°æ®', 
                    'lines': 'çº¿æ•°æ®', 
                    'polygons': 'å¤šè¾¹å½¢æ•°æ®' 
                };
                document.getElementById('current-tab-indicator').innerHTML = 
                    `å½“å‰é€‰ä¸­: <strong>${tabNames[currentTab]}</strong>`;
            }

            function showCurrent() { 
                clearAll(); 
                if (currentTab === 'points') showPoints(); 
                else if (currentTab === 'lines') showLines(); 
                else if (currentTab === 'polygons') showPolygons(); 
            }

            function showAll() { 
                clearAll(); 
                showPoints(); 
                showLines(); 
                showPolygons(); 
            }

            // æ˜¾ç¤ºç‚¹æ•°æ® - ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹çš„æ ¼å¼
            function showPoints() {
                points.forEach(point => map.remove(point)); 
                points = [];
                
                var input = document.getElementById('points-input').value.trim();
                if (!input) {
                    showStatus('ç‚¹æ•°æ®è¾“å…¥ä¸ºç©º', false);
                    return;
                }
                
                var format = detectFormat(input, 'points');
                
                try {
                    if (format === 'coords') {
                        // åæ ‡ä¸²æ ¼å¼
                        var pointStrings = input.split(';');
                        var pointCount = 0;
                        
                        pointStrings.forEach(pointStr => {
                            var parts = pointStr.split(',');
                            if (parts.length >= 2) {
                                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                if (!isNaN(lng) && !isNaN(lat)) {
                                    var point = new AMap.Marker({
                                        position: [lng, lat],
                                        icon: new AMap.Icon({
                                            size: new AMap.Size(8, 8),
                                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgIGhlaWdodD0iOCIgdmlld0JveD0iMCAwIDggOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI0IiBjeT0iNCIgcj0iNCIgZmlsbD0iIzI4YTc0NSIvPjwvc3ZnPg==',
                                            anchor: 'center'
                                        })
                                    });
                                    map.add(point); 
                                    points.push(point);
                                    pointCount++;
                                }
                            }
                        });
                        
                        if (pointCount > 0) {
                            showStatus(`æˆåŠŸæ·»åŠ  ${pointCount} ä¸ªç‚¹`, true);
                            map.setFitView(points);
                        } else {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç‚¹åæ ‡', false);
                        }
                    } else if (format === 'wkt') {
                        // WKTæ ¼å¼
                        var pointCount = 0;
                        
                        if (input.toUpperCase().startsWith('MULTIPOINT')) {
                            var content = input.substring(input.indexOf('(') + 1, input.lastIndexOf(')'));
                            var pointStrings = content.split('),(').map(point => {
                                point = point.trim();
                                if (point.startsWith('(')) point = point.substring(1);
                                if (point.endsWith(')')) point = point.substring(0, point.length - 1);
                                return point;
                            });
                            
                            pointStrings.forEach(pointContent => {
                                var parts = pointContent.split(/\s+/);
                                if (parts.length >= 2) {
                                    var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                    if (!isNaN(lng) && !isNaN(lat)) {
                                        var point = new AMap.Marker({
                                            position: [lng, lat],
                                            icon: new AMap.Icon({
                                                size: new AMap.Size(8, 8),
                                                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgIGhlaWdodD0iOCIgdmlld0JveD0iMCAwIDggOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI0IiBjeT0iNCIgcj0iNCIgZmlsbD0iIzI4YTc0NSIvPjwvc3ZnPg==',
                                                anchor: 'center'
                                            })
                                        });
                                        map.add(point); 
                                        points.push(point);
                                        pointCount++;
                                    }
                                }
                            });
                        } else if (input.toUpperCase().startsWith('POINT')) {
                            var content = input.substring(input.indexOf('(') + 1, input.lastIndexOf(')'));
                            var parts = content.trim().split(/\s+/);
                            if (parts.length >= 2) {
                                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                if (!isNaN(lng) && !isNaN(lat)) {
                                    var point = new AMap.Marker({
                                        position: [lng, lat],
                                        icon: new AMap.Icon({
                                            size: new AMap.Size(8, 8),
                                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgIGhlaWdodD0iOCIgdmlld0JveD0iMCAwIDggOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI0IiBjeT0iNCIgcj0iNCIgZmlsbD0iIzI4YTc0NSIvPjwvc3ZnPg==',
                                            anchor: 'center'
                                        })
                                    });
                                    map.add(point); 
                                    points.push(point);
                                    pointCount++;
                                }
                            }
                        }
                        
                        if (pointCount > 0) {
                            showStatus(`æˆåŠŸæ·»åŠ  ${pointCount} ä¸ªç‚¹`, true);
                            map.setFitView(points);
                        } else {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç‚¹åæ ‡', false);
                        }
                    } else {
                        showStatus('æ— æ³•è¯†åˆ«ç‚¹æ•°æ®æ ¼å¼ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼', false);
                    }
                } catch (error) { 
                    showStatus('è§£æé”™è¯¯: ' + error.message, false);
                }
            }

            // æ˜¾ç¤ºçº¿æ•°æ® - ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹çš„æ ¼å¼
            function showLines() {
                lines.forEach(line => map.remove(line)); 
                lines = [];
                
                var input = document.getElementById('lines-input').value.trim();
                if (!input) {
                    showStatus('çº¿æ•°æ®è¾“å…¥ä¸ºç©º', false);
                    return;
                }
                
                var format = detectFormat(input, 'lines');
                
                try {
                    if (format === 'coords') {
                        // åæ ‡ä¸²æ ¼å¼ - ä½¿ç”¨ | åˆ†éš”ä¸åŒçš„çº¿
                        var lineStrings = input.split('|');
                        var lineCount = 0;
                        
                        lineStrings.forEach(lineStr => {
                            var coords = [];
                            var points = lineStr.split(';');
                            points.forEach(point => {
                                var parts = point.split(',');
                                if (parts.length >= 2) {
                                    var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                    if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
                                }
                            });
                            if (coords.length > 1) {
                                var line = new AMap.Polyline({ 
                                    path: coords, 
                                    strokeColor: '#3388FF', 
                                    strokeWeight: 4, 
                                    strokeOpacity: 0.8 
                                });
                                map.add(line); 
                                lines.push(line);
                                lineCount++;
                            }
                        });
                        
                        if (lineCount > 0) {
                            showStatus(`æˆåŠŸæ·»åŠ  ${lineCount} æ¡çº¿`, true);
                            map.setFitView(lines);
                        } else {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„çº¿æ•°æ®', false);
                        }
                    } else if (format === 'wkt') {
                        // WKTæ ¼å¼
                        var lineCount = 0;
                        
                        if (input.toUpperCase().startsWith('MULTILINESTRING')) {
                            // å¤„ç†MULTILINESTRINGæ ¼å¼
                            var content = input.substring(input.indexOf('((') + 2, input.lastIndexOf('))'));
                            var lineStrings = content.split('),(');
                            
                            lineStrings.forEach(lineContent => {
                                var coords = [];
                                var points = lineContent.split(',');
                                
                                points.forEach(point => {
                                    point = point.trim();
                                    var parts = point.split(/\s+/);
                                    if (parts.length >= 2) {
                                        var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                        if (!isNaN(lng) && !isNaN(lat)) {
                                            coords.push([lng, lat]);
                                        }
                                    }
                                });
                                
                                if (coords.length > 1) {
                                    var line = new AMap.Polyline({ 
                                        path: coords, 
                                        strokeColor: '#3388FF', 
                                        strokeWeight: 4, 
                                        strokeOpacity: 0.8 
                                    });
                                    map.add(line); 
                                    lines.push(line);
                                    lineCount++;
                                }
                            });
                        } else if (input.toUpperCase().startsWith('LINESTRING')) {
                            // å¤„ç†LINESTRINGæ ¼å¼
                            var content = input.substring(input.indexOf('(') + 1, input.lastIndexOf(')'));
                            var coords = [];
                            var points = content.split(',');
                            
                            points.forEach(point => {
                                point = point.trim();
                                var parts = point.split(/\s+/);
                                if (parts.length >= 2) {
                                    var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                    if (!isNaN(lng) && !isNaN(lat)) {
                                        coords.push([lng, lat]);
                                    }
                                }
                            });
                            
                            if (coords.length > 1) {
                                var line = new AMap.Polyline({ 
                                    path: coords, 
                                    strokeColor: '#3388FF', 
                                    strokeWeight: 4, 
                                    strokeOpacity: 0.8 
                                });
                                map.add(line); 
                                lines.push(line);
                                lineCount++;
                            }
                        }
                        
                        if (lineCount > 0) {
                            showStatus(`æˆåŠŸæ·»åŠ  ${lineCount} æ¡çº¿`, true);
                            map.setFitView(lines);
                        } else {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„çº¿æ•°æ®', false);
                        }
                    } else {
                        showStatus('æ— æ³•è¯†åˆ«çº¿æ•°æ®æ ¼å¼ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼', false);
                    }
                } catch (error) { 
                    showStatus('è§£æé”™è¯¯: ' + error.message, false);
                }
            }

            // æ˜¾ç¤ºå¤šè¾¹å½¢æ•°æ® - ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹çš„æ ¼å¼
            function showPolygons() {
                polygons.forEach(polygon => map.remove(polygon)); 
                polygons = [];
                
                var input = document.getElementById('polygon-input').value.trim();
                if (!input) {
                    showStatus('å¤šè¾¹å½¢æ•°æ®è¾“å…¥ä¸ºç©º', false);
                    return;
                }
                
                var format = detectFormat(input, 'polygons');
                
                try {
                    if (format === 'coords') {
                        // åæ ‡ä¸²æ ¼å¼
                        var points = input.split(';'), coords = [];
                        points.forEach(point => {
                            var parts = point.split(',');
                            if (parts.length >= 2) {
                                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
                            }
                        });
                        if (coords.length >= 3) {
                            // ç¡®ä¿å¤šè¾¹å½¢é—­åˆ
                            if (coords[0][0] !== coords[coords.length-1][0] || coords[0][1] !== coords[coords.length-1][1]) {
                                coords.push([coords[0][0], coords[0][1]]);
                            }
                            
                            var polygon = new AMap.Polygon({
                                path: coords, 
                                strokeColor: '#FF6B6B', 
                                strokeWeight: 3, 
                                strokeOpacity: 0.8,
                                fillColor: '#FF6B6B', 
                                fillOpacity: 0.3
                            });
                            map.add(polygon); 
                            polygons.push(polygon);
                            map.setFitView([polygon]);
                            showStatus('æˆåŠŸæ·»åŠ å¤šè¾¹å½¢', true);
                        } else {
                            showStatus('å¤šè¾¹å½¢éœ€è¦è‡³å°‘3ä¸ªç‚¹', false);
                        }
                    } else if (format === 'wkt') {
                        // WKTæ ¼å¼
                        var polygonCount = 0;
                        
                        // å¤„ç†å¤šè¡Œè¾“å…¥ï¼Œæ¯è¡Œä¸€ä¸ªPOLYGON
                        var polygonStrings = input.split('\n').filter(line => line.trim() !== '');
                        
                        polygonStrings.forEach(polygonStr => {
                            polygonStr = polygonStr.trim();
                            
                            if (polygonStr.toUpperCase().startsWith('POLYGON')) {
                                var content = polygonStr.substring(polygonStr.indexOf('((') + 2, polygonStr.lastIndexOf('))'));
                                var rings = content.split('),(');
                                
                                rings.forEach(ringContent => {
                                    var coords = [];
                                    var points = ringContent.split(',');
                                    
                                    points.forEach(point => {
                                        point = point.trim();
                                        var parts = point.split(/\s+/);
                                        if (parts.length >= 2) {
                                            var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                            if (!isNaN(lng) && !isNaN(lat)) {
                                                coords.push([lng, lat]);
                                            }
                                        }
                                    });
                                    
                                    // ç¡®ä¿å¤šè¾¹å½¢é—­åˆ
                                    if (coords.length > 0 && (coords[0][0] !== coords[coords.length-1][0] || coords[0][1] !== coords[coords.length-1][1])) {
                                        coords.push([coords[0][0], coords[0][1]]);
                                    }
                                    
                                    if (coords.length >= 3) {
                                        var polygon = new AMap.Polygon({
                                            path: coords, 
                                            strokeColor: '#FF6B6B', 
                                            strokeWeight: 3, 
                                            strokeOpacity: 0.8,
                                            fillColor: '#FF6B6B', 
                                            fillOpacity: 0.3
                                        });
                                        map.add(polygon); 
                                        polygons.push(polygon);
                                        polygonCount++;
                                    }
                                });
                            } else if (polygonStr.toUpperCase().startsWith('MULTIPOLYGON')) {
                                var multiContent = polygonStr.substring(polygonStr.indexOf('((') + 2, polygonStr.lastIndexOf('))'));
                                var polygonsContent = multiContent.split(')),((');
                                
                                polygonsContent.forEach(polyContent => {
                                    var rings = polyContent.split('),(');
                                    
                                    rings.forEach(ringContent => {
                                        var coords = [];
                                        var points = ringContent.split(',');
                                        points.forEach(point => {
                                            var parts = point.trim().split(/\s+/);
                                            if (parts.length >= 2) {
                                                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                                                if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
                                            }
                                        });
                                        
                                        if (coords.length >= 3) {
                                            var polygon = new AMap.Polygon({
                                                path: coords, 
                                                strokeColor: '#FF6B6B', 
                                                strokeWeight: 3, 
                                                strokeOpacity: 0.8,
                                                fillColor: '#FF6B6B', 
                                                fillOpacity: 0.3
                                            });
                                            map.add(polygon); 
                                            polygons.push(polygon);
                                            polygonCount++;
                                        }
                                    });
                                });
                            }
                        });
                        
                        if (polygonCount > 0) {
                            showStatus(`æˆåŠŸæ·»åŠ  ${polygonCount} ä¸ªå¤šè¾¹å½¢`, true);
                            map.setFitView(polygons);
                        } else {
                            showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å¤šè¾¹å½¢æ•°æ®', false);
                        }
                    } else {
                        showStatus('æ— æ³•è¯†åˆ«å¤šè¾¹å½¢æ•°æ®æ ¼å¼ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼', false);
                    }
                } catch (error) { 
                    console.error('è§£æé”™è¯¯:', error);
                    showStatus('è§£æé”™è¯¯: ' + error.message, false);
                }
            }

            function clearAll() {
                points.forEach(point => map.remove(point)); 
                points = [];
                lines.forEach(line => map.remove(line)); 
                lines = [];
                polygons.forEach(polygon => map.remove(polygon)); 
                polygons = [];
                showStatus('å·²æ¸…é™¤æ‰€æœ‰å›¾å½¢', true);
            }

            // äº‹ä»¶ç›‘å¬
            document.getElementById('show-current-btn').addEventListener('click', showCurrent);
            document.getElementById('show-all-btn').addEventListener('click', showAll);
            document.getElementById('clear-all-btn').addEventListener('click', clearAll);

            // åˆå§‹åŒ–
            setTimeout(function() { 
                updateCurrentTabIndicator();
                // åˆå§‹åŒ–æ ¼å¼æ£€æµ‹
                updateFormatIndicator('points');
                updateFormatIndicator('lines');
                updateFormatIndicator('polygons');
                // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰å›¾å½¢
                showAll();
            }, 500);
        });
    </script>
</body>
</html>
