<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
  <title>几何数据展示工具</title>
  <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
  <style>
    html, body, #container {
      width: 100%; height: 100%; margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .control-panel {
      position: absolute; top: 20px; left: 20px; width: 350px;
      background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      border-radius: 8px; padding: 0; z-index: 10;
      max-height: 85vh; overflow-y: auto;
    }
    .panel-header {
      background: #3388FF; color: white; padding: 15px;
      border-radius: 8px 8px 0 0; margin: 0;
      position: sticky; top: 0; z-index: 11;
    }
    .panel-header h3 { margin: 0; font-size: 18px; }
    .panel-content { padding: 15px; }
    .tabs {
      display: flex; border-bottom: 1px solid #eee; margin-bottom: 15px;
      position: sticky; top: 60px; background: white; z-index: 10; padding-top: 5px;
    }
    .tab {
      flex: 1; padding: 10px; text-align: center; cursor: pointer;
      border-bottom: 2px solid transparent; transition: all 0.3s;
      font-size: 14px;
    }
    .tab.active {
      border-bottom: 2px solid #3388FF; color: #3388FF; font-weight: bold;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .input-item { margin-bottom: 15px; }
    .input-item label {
      display: block; margin-bottom: 5px; font-weight: bold;
      color: #555; font-size: 14px;
    }
    .input-item textarea {
      width: 100%; height: 100px; margin: 5px 0; padding: 10px;
      border: 1px solid #ddd; border-radius: 4px; resize: vertical;
      font-family: monospace; font-size: 12px; box-sizing: border-box;
    }
    .format-example {
      font-size: 11px; color: #666; margin-top: 5px; font-style: italic;
    }
    .button-group {
      display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0;
    }
    .button-group button {
      flex: 1; min-width: 120px; padding: 10px; border: none;
      border-radius: 4px; cursor: pointer; font-weight: bold;
      transition: background 0.3s;
    }
    .btn-primary { background: #3388FF; color: white; }
    .btn-primary:hover { background: #297acc; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-secondary:hover { background: #5a6268; }
    .btn-success { background: #28a745; color: white; }
    .btn-success:hover { background: #218838; }
    .btn-warning { background: #ffc107; color: #212529; }
    .btn-warning:hover { background: #e0a800; }
    .btn-info { background: #17a2b8; color: white; }
    .btn-info:hover { background: #138496; }
    .stats {
      margin-top: 15px; padding: 12px; background: #f8f9fa;
      border-radius: 4px; font-size: 13px; border-left: 4px solid #3388FF;
    }
    .legend {
      margin-top: 15px; padding: 12px; background: #f8f9fa;
      border-radius: 4px; font-size: 12px;
    }
    .legend-item {
      display: flex; align-items: center; margin: 5px 0;
    }
    .legend-color {
      width: 20px; height: 3px; margin-right: 8px;
    }
    .legend-point {
      width: 12px; height: 12px; border-radius: 50%; margin-right: 8px;
    }
    .legend-line { background-color: #3388FF; }
    .legend-polygon { background-color: #FF6B6B; }
    .legend-point-color { background-color: #28a745; }
    .action-buttons {
      position: sticky; bottom: 0; background: white;
      padding: 10px 0; border-top: 1px solid #eee; margin-top: 10px;
    }
    .current-tab-indicator {
      background: #e7f3ff; padding: 8px 12px; border-radius: 4px;
      margin: 10px 0; font-size: 13px; border-left: 3px solid #3388FF;
    }
    .input-format-selector {
      display: flex; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; overflow: hidden;
    }
    .format-option {
      flex: 1; padding: 8px; text-align: center; cursor: pointer; background: #f8f9fa;
      border-right: 1px solid #ddd; font-size: 12px;
    }
    .format-option:last-child { border-right: none; }
    .format-option.active { background: #3388FF; color: white; }
    @media (max-width: 768px) {
      .control-panel { width: calc(100% - 40px); max-height: 50vh; }
      .input-item textarea { height: 80px; }
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <div class="control-panel">
    <div class="panel-header"><h3>几何数据展示工具</h3></div>
    <div class="panel-content">
      <div class="tabs">
        <div class="tab active" data-tab="points">点数据</div>
        <div class="tab" data-tab="lines">线数据</div>
        <div class="tab" data-tab="polygons">多边形数据</div>
      </div>
      <div class="current-tab-indicator" id="current-tab-indicator">当前选中: <strong>点数据</strong></div>
      
      <!-- 点数据标签页 -->
      <div class="tab-content active" id="points-tab">
        <div class="input-item">
          <label for="points-input">WKT格式点数据</label>
          <textarea id="points-input">MULTIPOINT((116.29642223 39.92031415),(116.29628966 39.91976904),(116.29609911 39.91929966),(116.29603309 39.91915046),(116.29583764 39.91876747),(116.29581320 39.91873134),(116.29570371 39.91856958),(116.29545868 39.91814503),(116.29514603 39.91752918),(116.29501289 39.91723948),(116.29494476 39.91699938),(116.29489826 39.91671971),(116.29488629 39.91630827),(116.29488051 39.91574014),(116.29490872 39.91308447),(116.29490760 39.91291666),(116.29487722 39.91027120),(116.29487841 39.91016540),(116.29487731 39.90937277),(116.29487633 39.90788590),(116.29488021 39.90774420),(116.29487939 39.90754059),(116.29487967 39.90741848),(116.29488256 39.90724998),(116.29487908 39.90665645),(116.29488178 39.90584202),(116.29491909 39.90387818),(116.29492613 39.90247943),(116.29488469 39.90024547),(116.29491660 39.89835033),(116.29491037 39.89741638),(116.29491105 39.89724997))</textarea>
          <div class="format-example">格式示例: MULTIPOINT((lng1 lat1),(lng2 lat2),...)</div>
        </div>
        <div class="button-group">
          <button class="btn-info" id="show-points-btn">显示点</button>
        </div>
      </div>
      
      <!-- 线数据标签页 -->
      <div class="tab-content" id="lines-tab">
        <div class="input-item">
          <label for="wkt-input">WKT格式线数据</label>
          <textarea id="wkt-input">MULTILINESTRING((116.29642223 39.92031415,116.29628966 39.91976904,116.29609911 39.91929966,116.29603309 39.91915046,116.29583764 39.91876747,116.29581320 39.91873134,116.29570371 39.91856958,116.29545868 39.91814503,116.29514603 39.91752918,116.29501289 39.91723948,116.29494476 39.91699938,116.29489826 39.91671971,116.29488629 39.91630827,116.29488051 39.91574014,116.29490872 39.91308447,116.29490760 39.91291666,116.29487722 39.91027120,116.29487841 39.91016540,116.29487731 39.90937277,116.29487633 39.90788590,116.29488021 39.90774420,116.29487939 39.90754059,116.29487967 39.90741848,116.29488256 39.90724998,116.29487908 39.90665645,116.29488178 39.90584202,116.29491909 39.90387818,116.29492613 39.90247943,116.29488469 39.90024547,116.29491660 39.89835033,116.29491037 39.89741638,116.29491105 39.89724997),(116.29507250 39.89724579,116.29508494 39.89823985,116.29507074 39.90002902,116.29507217 39.90025133,116.29507137 39.90104876,116.29507844 39.90156980,116.29509458 39.90247856,116.29509586 39.90387622,116.29508062 39.90620530,116.29507453 39.90713944,116.29507555 39.90725024,116.29507707 39.90741995,116.29508029 39.90754506,116.29510976 39.90774271,116.29510120 39.90897805,116.29510065 39.90934997,116.29509377 39.90965097,116.29507910 39.91005047,116.29507901 39.91016697,116.29507243 39.91277858,116.29507225 39.91291388,116.29506200 39.91510776,116.29506546 39.91550458,116.29505853 39.91616060,116.29506567 39.91638752,116.29508593 39.91660366,116.29511439 39.91677590,116.29513905 39.91692934,116.29518844 39.91711542,116.29522873 39.91729078,116.29530647 39.91750979,116.29580013 39.91838101,116.29588207 39.91848642,116.29593105 39.91854619,116.29602943 39.91870614,116.29622888 39.91909563,116.29627557 39.91919310),(116.29627557 39.91919310,116.29643673 39.91933013,116.29658169 39.91955034,116.29672514 39.91977375),(116.29627557 39.91919310,116.29636994 39.91940134,116.29654125 39.91973479,116.29668039 39.91996919),(116.29656592 39.92400730,116.29656951 39.92308707,116.29656622 39.92079527,116.29642223 39.92031415),(116.29643838 39.92286908,116.29641283 39.92200230,116.29640344 39.92141387,116.29640612 39.92122886,116.29640541 39.92112446,116.29640327 39.92082584,116.29639333 39.92066222,116.29642223 39.92031415),(116.29733804 39.92085906,116.29740988 39.92109857,116.29742994 39.92130470,116.29743228 39.92156452,116.29744383 39.92264088,116.29748936 39.92311946,116.29749469 39.92328018,116.29752192 39.92397865),(116.29744230 39.92077120,116.29747315 39.92082735,116.29757185 39.92117990,116.29759402 39.92140054,116.29760475 39.92150716,116.29762291 39.92178080,116.29759598 39.92189756,116.29760000 39.92204038,116.29760453 39.92220159,116.29761038 39.92253101,116.29760571 39.92277732,116.29757427 39.92292088))</textarea>
          <div class="format-example">格式示例: MULTILINESTRING((lng1 lat1,lng2 lat2,...),(lng1 lat1,lng2 lat2,...))</div>
        </div>
        <div class="button-group">
          <button class="btn-primary" id="show-lines-btn">显示线段</button>
        </div>
      </div>
      
      <!-- 多边形数据标签页 -->
      <div class="tab-content" id="polygons-tab">
        <div class="input-format-selector" id="polygon-format-selector">
          <div class="format-option active" data-format="coords">坐标串格式</div>
          <div class="format-option" data-format="wkt">WKT格式</div>
        </div>
        <div class="input-item">
          <label for="polygon-input">多边形数据</label>
          <textarea id="polygon-input">116.381098,39.956666;116.382257,39.956668;116.382346,39.955707;116.381771,39.955661;116.381763,39.955471;116.381179,39.955447;116.381098,39.956666</textarea>
          <div class="format-example" id="polygon-format-example">格式示例: lng1,lat1;lng2,lat2;lng3,lat3;...</div>
        </div>
        <div class="button-group">
          <button class="btn-success" id="show-polygons-btn">显示多边形</button>
        </div>
      </div>
      
      <div class="action-buttons">
        <div class="button-group">
          <button class="btn-primary" id="show-all-btn">显示所有图形</button>
          <button class="btn-warning" id="show-current-btn">仅显示当前图形</button>
          <button class="btn-secondary" id="clear-all-btn">清除所有</button>
        </div>
        <div class="stats" id="stats">点击上方按钮显示几何数据</div>
        <div class="legend">
          <div class="legend-item"><div class="legend-point legend-point-color"></div><span>点数据</span></div>
          <div class="legend-item"><div class="legend-color legend-line"></div><span>线数据</span></div>
          <div class="legend-item"><div class="legend-color legend-polygon"></div><span>多边形数据</span></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
  <script src="https://webapi.amap.com/maps?v=2.0&key=1cf9fc45df860df45e87af1230f5da74"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var map = new AMap.Map('container', { zoom: 14, center: [116.296, 39.917], viewMode: '3D' });
      var points = [], lines = [], polygons = [], currentTab = 'points';
      var polygonFormat = 'coords'; // 默认多边形格式
      
      // 标签切换
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          this.classList.add('active');
          const tabId = this.getAttribute('data-tab');
          document.getElementById(tabId + '-tab').classList.add('active');
          currentTab = tabId;
          updateCurrentTabIndicator();
        });
      });

      // 多边形格式切换
      document.querySelectorAll('.format-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.format-option').forEach(o => o.classList.remove('active'));
          this.classList.add('active');
          polygonFormat = this.getAttribute('data-format');
          updatePolygonFormatExample();
        });
      });

      function updatePolygonFormatExample() {
        const example = document.getElementById('polygon-format-example');
        if (polygonFormat === 'coords') {
          example.textContent = '格式示例: lng1,lat1;lng2,lat2;lng3,lat3;...';
        } else {
          example.textContent = '格式示例: POLYGON((lng1 lat1,lng2 lat2,lng3 lat3,...))';
        }
      }

      function updateCurrentTabIndicator() {
        const tabNames = { 'points': '点数据', 'lines': '线数据', 'polygons': '多边形数据' };
        document.getElementById('current-tab-indicator').innerHTML = `当前选中: <strong>${tabNames[currentTab]}</strong>`;
      }

      function showAll() { clearAll(); showPoints(); showLines(); showPolygons(); }
      function showCurrent() { clearAll(); 
        if (currentTab === 'points') showPoints(); 
        else if (currentTab === 'lines') showLines(); 
        else if (currentTab === 'polygons') showPolygons(); 
        updateStats(); 
      }

      // 显示点数据
      function showPoints() {
        points.forEach(point => map.remove(point)); points = [];
        var wkt = document.getElementById('points-input').value.trim();
        try {
          if (wkt.toUpperCase().startsWith('MULTIPOINT')) {
            var content = wkt.substring(wkt.indexOf('(') + 1, wkt.lastIndexOf(')'));
            var pointStrings = content.split('),(').map(point => {
              point = point.trim();
              if (point.startsWith('(')) point = point.substring(1);
              if (point.endsWith(')')) point = point.substring(0, point.length - 1);
              return point;
            });
            
            pointStrings.forEach(pointContent => {
              var parts = pointContent.split(/\s+/);
              if (parts.length >= 2) {
                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                if (!isNaN(lng) && !isNaN(lat)) {
                  var point = new AMap.Marker({
                    position: [lng, lat],
                    icon: new AMap.Icon({
                      size: new AMap.Size(6, 6),
                      image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB2aWV3Qm94PSIwIDAgNiA2IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBmaWxsPSIjMjhhNzQ1Ii8+PC9zdmc+',
                      anchor: 'center'
                    })
                  });
                  map.add(point); points.push(point);
                }
              }
            });
          } else if (wkt.toUpperCase().startsWith('POINT')) {
            var content = wkt.substring(wkt.indexOf('(') + 1, wkt.lastIndexOf(')'));
            var parts = content.trim().split(/\s+/);
            if (parts.length >= 2) {
              var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
              if (!isNaN(lng) && !isNaN(lat)) {
                var point = new AMap.Marker({
                  position: [lng, lat],
                  icon: new AMap.Icon({
                    size: new AMap.Size(6, 6),
                    image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB2aWV3Qm94PSIwIDAgNiA2IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjMiIGN5PSIzIiByPSIzIiBmaWxsPSIjMjhhNzQ1Ii8+PC9zdmc+',
                    anchor: 'center'
                  })
                });
                map.add(point); points.push(point);
              }
            }
          }
          updateStats();
        } catch (error) { alert('解析错误: ' + error.message); }
      }

      // 显示线数据
      function showLines() {
        lines.forEach(line => map.remove(line)); lines = [];
        var wkt = document.getElementById('wkt-input').value.trim();
        try {
          var content = wkt.substring(wkt.indexOf('(') + 1, wkt.lastIndexOf(')'));
          var lineStrings = content.split('),(').map(line => {
            line = line.trim();
            if (line.startsWith('(')) line = line.substring(1);
            if (line.endsWith(')')) line = line.substring(0, line.length - 1);
            return line;
          });
          lineStrings.forEach(lineContent => {
            var coords = []; var points = lineContent.split(',');
            points.forEach(point => {
              point = point.trim(); var parts = point.split(/\s+/);
              if (parts.length >= 2) {
                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
              }
            });
            if (coords.length > 1) {
              var line = new AMap.Polyline({ path: coords, strokeColor: '#3388FF', strokeWeight: 3, strokeOpacity: 0.8 });
              map.add(line); lines.push(line);
            }
          });
          updateStats();
        } catch (error) { alert('解析错误: ' + error.message); }
      }

      // 显示多边形数据
      function showPolygons() {
        polygons.forEach(polygon => map.remove(polygon)); polygons = [];
        var polygonInput = document.getElementById('polygon-input').value.trim();
        try {
          if (polygonFormat === 'coords') {
            // 坐标串格式
            var points = polygonInput.split(';'), coords = [];
            points.forEach(point => {
              var parts = point.split(',');
              if (parts.length >= 2) {
                var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
              }
            });
            if (coords.length >= 3) {
              var polygon = new AMap.Polygon({
                path: coords, strokeColor: '#FF6B6B', strokeWeight: 2, strokeOpacity: 0.8,
                fillColor: '#FF6B6B', fillOpacity: 0.3
              });
              map.add(polygon); polygons.push(polygon);
            }
          } else {
            // WKT格式
            if (polygonInput.toUpperCase().startsWith('POLYGON')) {
              var content = polygonInput.substring(polygonInput.indexOf('((') + 2, polygonInput.lastIndexOf('))'));
              var rings = content.split('),(');
              
              rings.forEach(ringContent => {
                var coords = [];
                var points = ringContent.split(',');
                points.forEach(point => {
                  var parts = point.trim().split(/\s+/);
                  if (parts.length >= 2) {
                    var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                    if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
                  }
                });
                
                if (coords.length >= 3) {
                  var polygon = new AMap.Polygon({
                    path: coords, strokeColor: '#FF6B6B', strokeWeight: 2, strokeOpacity: 0.8,
                    fillColor: '#FF6B6B', fillOpacity: 0.3
                  });
                  map.add(polygon); polygons.push(polygon);
                }
              });
            } else if (polygonInput.toUpperCase().startsWith('MULTIPOLYGON')) {
              var multiContent = polygonInput.substring(polygonInput.indexOf('((') + 2, polygonInput.lastIndexOf('))'));
              var polygonsContent = multiContent.split(')),((');
              
              polygonsContent.forEach(polyContent => {
                var rings = polyContent.split('),(');
                
                rings.forEach(ringContent => {
                  var coords = [];
                  var points = ringContent.split(',');
                  points.forEach(point => {
                    var parts = point.trim().split(/\s+/);
                    if (parts.length >= 2) {
                      var lng = parseFloat(parts[0]), lat = parseFloat(parts[1]);
                      if (!isNaN(lng) && !isNaN(lat)) coords.push([lng, lat]);
                    }
                  });
                  
                  if (coords.length >= 3) {
                    var polygon = new AMap.Polygon({
                      path: coords, strokeColor: '#FF6B6B', strokeWeight: 2, strokeOpacity: 0.8,
                      fillColor: '#FF6B6B', fillOpacity: 0.3
                    });
                    map.add(polygon); polygons.push(polygon);
                  }
                });
              });
            }
          }
          updateStats();
        } catch (error) { alert('解析错误: ' + error.message); }
      }

      function updateStats() {
        var pointCount = points.length, lineCount = lines.length, polygonCount = polygons.length;
        var linePoints = lines.reduce((sum, line) => sum + line.getPath().length, 0);
        var polygonPoints = polygons.reduce((sum, polygon) => sum + polygon.getPath().length, 0);
        document.getElementById('stats').innerHTML = `点: ${pointCount}个<br>线段: ${lineCount}条<br>多边形: ${polygonCount}个<br>线顶点: ${linePoints}个<br>多边形顶点: ${polygonPoints}个`;
        if (points.length > 0 || lines.length > 0 || polygons.length > 0) map.setFitView();
      }

      function clearAll() {
        points.forEach(point => map.remove(point)); points = [];
        lines.forEach(line => map.remove(line)); lines = [];
        polygons.forEach(polygon => map.remove(polygon)); polygons = [];
        document.getElementById('stats').innerHTML = '已清除所有图形';
      }

      // 事件监听
      document.getElementById('show-points-btn').addEventListener('click', showPoints);
      document.getElementById('show-lines-btn').addEventListener('click', showLines);
      document.getElementById('show-polygons-btn').addEventListener('click', showPolygons);
      document.getElementById('show-all-btn').addEventListener('click', showAll);
      document.getElementById('show-current-btn').addEventListener('click', showCurrent);
      document.getElementById('clear-all-btn').addEventListener('click', clearAll);

      // 初始化
      setTimeout(function() { 
        showAll(); 
        updateCurrentTabIndicator(); 
        updatePolygonFormatExample();
      }, 500);
    });
  </script>
</body>
</html>
